<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>24-Hour Analog Clock with Prayer Times (SVG Segments)</title>
    <link href="https://fonts.googleapis.com/css2?family=Marcellus&family=Noto+Naskh+Arabic:wght@400;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --clock-size: 330px;
            --body-bg: #0B1F3A;
            --clock-border-color: #D4AF37;
            /* Gold */
            --face-bg: #F5F5DC;
            --number-color: #3A2E1F;
            --hour-hand-color: #B08D57;
            --minute-hand-color: #3A2E1F;
            --second-hand-color: #C04000;
            --center-dot-color: var(--clock-border-color);
            --date-color: #E0D6C3;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --marker-color: rgba(58, 46, 31, 0.5);
            --prayer-marker-color: var(--clock-border-color);
            --prayer-marker-bg: rgba(11, 31, 58, 0.8);
            /* Slightly transparent body-bg */

            --clock-actual-outer-radius: calc(var(--clock-size) / 2 + 8px);
            --clock-visual-outer-radius-with-blue-shadow: calc(var(--clock-actual-outer-radius) + 4px);
            --prayer-ring-offset: 12px;
            --prayer-marker-size: 12px;
            --prayer-marker-path-radius: calc(var(--clock-visual-outer-radius-with-blue-shadow) + var(--prayer-ring-offset) + (var(--prayer-marker-size) / 2));
            --master-container-size: calc(var(--prayer-marker-path-radius) * 2);

            /* Colors for the prayer ring gradient segments */
            --color-segment-1: #003f5c;
            /* Isha to Fajr (Night) */
            --color-segment-2: #2f7a90;
            /* Fajr to Dhuhr (Dawn/Morning) */
            --color-segment-3: #f9a828;
            /* Dhuhr to Asr (Midday/Early Afternoon) */
            --color-segment-4: #c97b41;
            /* Asr to Maghrib (Late Afternoon) */
            --color-segment-5: #8c503a;
            /* Maghrib to Isha (Evening) */
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: var(--body-bg);
            background-image:
                radial-gradient(circle at center, rgba(255, 215, 0, 0.03) 0%, rgba(255, 215, 0, 0.03) 1px, transparent 1px, transparent 100%),
                radial-gradient(circle at center, rgba(255, 255, 255, 0.02) 0%, rgba(255, 255, 255, 0.02) 1px, transparent 1px, transparent 100%);
            background-size: 40px 40px, 20px 20px;
            font-family: 'Marcellus', serif;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            color: var(--date-color);
        }

        #date-display {
            font-size: 1.9em;
            margin-bottom: 20px;
            font-weight: 400;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
            text-align: center;
            color: var(--date-color);
            letter-spacing: 1px;
        }

        #prayer-time-info {
            font-size: 0.9em;
            margin-bottom: 25px;
            text-align: center;
            color: var(--date-color);
            opacity: 0.9;
            max-width: 90%;
            line-height: 1.4;
            min-height: 2.8em;
        }

        #prayer-time-info strong {
            color: var(--clock-border-color);
            font-weight: 600;
        }

        .master-clock-container {
            position: relative;
            width: var(--master-container-size);
            height: var(--master-container-size);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .clock-container {
            width: var(--clock-size);
            height: var(--clock-size);
            border-radius: 50%;
            border: 8px solid var(--clock-border-color);
            box-shadow: 0 5px 30px var(--shadow-color),
                inset 0 0 20px rgba(0, 0, 0, 0.15),
                0 0 0 4px var(--body-bg),
                0 0 0 8px rgba(212, 175, 55, 0.5);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--face-bg);
            background-image: url("data:image/svg+xml,%3csvg width='50' height='50' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='50' height='50' fill='%23F5F5DC'/%3e%3cpath d='M25 2 L29.27 12.27 L40.53 15.73 L32.27 25 L40.53 34.27 L29.27 37.73 L25 48 L20.73 37.73 L9.47 34.27 L17.73 25 L9.47 15.73 L20.73 12.27 Z' stroke='rgba(176,141,87,0.35)' stroke-width='1' fill='none'/%3e%3cpath d='M0 25 L50 25 M25 0 L25 50' stroke='rgba(176,141,87,0.20)' stroke-width='0.6' fill='none'/%3e%3cpath d='M0 0 L50 50 M0 50 L50 0' stroke='rgba(176,141,87,0.20)' stroke-width='0.6' fill='none'/%3e%3c/svg%3e");
            background-size: 50px 50px;
            background-repeat: repeat;
            z-index: 10;
        }

        .prayer-ring {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            pointer-events: none;
            z-index: 5;
            /* Background will be set by JS */
        }

        .prayer-marker {
            position: absolute;
            width: var(--prayer-marker-size);
            height: var(--prayer-marker-size);
            background-color: var(--prayer-marker-bg);
            border: 1.5px solid var(--prayer-marker-color);
            border-radius: 50% 0;
            transform-origin: center center;
            box-shadow: 0 0 3px rgba(212, 175, 55, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: calc(var(--prayer-marker-size) * 0.55);
            font-weight: bold;
            color: var(--prayer-marker-color);
            pointer-events: auto;
            z-index: 6;
        }

        .prayer-marker.fajr::before {
            content: "F";
        }

        .prayer-marker.dhuhr::before {
            content: "D";
        }

        .prayer-marker.asr::before {
            content: "A";
        }

        .prayer-marker.maghrib::before {
            content: "M";
        }

        .prayer-marker.isha::before {
            content: "I";
        }

        .hand {
            position: absolute;
            bottom: 50%;
            left: 50%;
            transform-origin: bottom center;
            border-radius: 4px 4px 1px 1px;
            box-shadow: 1px 1px 4px rgba(0, 0, 0, 0.3);
            z-index: 20;
        }

        .hour-hand {
            width: 7px;
            height: 26%;
            background-color: var(--hour-hand-color);
        }

        .minute-hand {
            width: 5px;
            height: 37%;
            background-color: var(--minute-hand-color);
            z-index: 21;
        }

        .second-hand {
            width: 2px;
            height: 41%;
            background-color: var(--second-hand-color);
            z-index: 22;
        }

        .center-dot {
            width: 14px;
            height: 14px;
            background-color: var(--center-dot-color);
            border: 2px solid var(--face-bg);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 23;
            box-shadow: 0 0 6px rgba(0, 0, 0, 0.4);
        }

        .center-dot::after {
            content: '';
            position: absolute;
            width: 5px;
            height: 5px;
            background-color: var(--number-color);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .clock-number {
            position: absolute;
            transform: translate(-50%, -50%);
            font-size: calc(var(--clock-size) * 0.09);
            font-family: 'Noto Naskh Arabic', 'Marcellus', serif;
            font-weight: 700;
            color: var(--number-color);
            z-index: 15;
            padding: 2px;
            text-shadow: 0px 0px 3px var(--face-bg), 0px 0px 5px var(--face-bg);
        }

        .marker {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            z-index: 12;
        }

        .marker::before {
            content: '';
            background-color: var(--marker-color);
            display: block;
            margin-top: calc(var(--clock-size) * 0.025);
            border-radius: 1px;
        }

        .marker.minor::before {
            width: calc(var(--clock-size) * 0.008);
            height: calc(var(--clock-size) * 0.025);
        }

        .marker.cardinal::before {
            width: calc(var(--clock-size) * 0.015);
            height: calc(var(--clock-size) * 0.05);
            background-color: var(--clock-border-color);
        }
    </style>
</head>

<body>

    <div id="date-display"></div>
    <div id="prayer-time-info">Loading prayer times...</div>

    <div class="master-clock-container">
        <div class="clock-container">
            <div class="hand hour-hand" data-hour-hand></div>
            <div class="hand minute-hand" data-minute-hand></div>
            <div class="hand second-hand" data-second-hand></div>
            <div class="center-dot"></div>
        </div>
        <div class="prayer-ring">
        </div>
    </div>

    <script>
        const hourHand = document.querySelector('[data-hour-hand]');
        const minuteHand = document.querySelector('[data-minute-hand]');
        const secondHand = document.querySelector('[data-second-hand]');
        const dateDisplay = document.getElementById('date-display');
        const clockContainer = document.querySelector('.clock-container');
        const prayerRing = document.querySelector('.prayer-ring');
        const prayerTimeInfo = document.getElementById('prayer-time-info');

        const numbersToDisplay = [0, 3, 6, 9, 12, 15, 18, 21];
        const numberRadiusPercentage = 40;

        let prayerScheduleForGradient = []; // Renamed, but used for segment calculations

        const CACHE_KEY_LOCATION = 'prayerClock_location';
        const CACHE_KEY_PRAYER_TIMES = 'prayerClock_prayerTimes';
        const CACHE_KEY_TIMESTAMP = 'prayerClock_timestamp';
        const CACHE_DURATION_MS = 24 * 60 * 60 * 1000;

        function setupClockFace() {
            try {
                clockContainer.querySelectorAll('.clock-number, .marker').forEach(el => el.remove());
                numbersToDisplay.forEach(hour => {
                    const numberDiv = document.createElement('div');
                    numberDiv.classList.add('clock-number');
                    numberDiv.textContent = hour;
                    const angleDegreesNum = (hour / 24) * 360;
                    const angleRadiansNum = angleDegreesNum * (Math.PI / 180);
                    const xPos = 50 + numberRadiusPercentage * Math.sin(angleRadiansNum);
                    const yPos = 50 - numberRadiusPercentage * Math.cos(angleRadiansNum);
                    numberDiv.style.left = `${xPos}%`;
                    numberDiv.style.top = `${yPos}%`;
                    clockContainer.appendChild(numberDiv);
                });
                for (let i = 0; i < 24; i++) {
                    if (!numbersToDisplay.includes(i)) {
                        const markerDiv = document.createElement('div');
                        markerDiv.classList.add('marker');
                        markerDiv.style.transform = `rotate(${i * 15}deg)`;
                        if (i % 6 === 0) markerDiv.classList.add('cardinal');
                        else markerDiv.classList.add('minor');
                        clockContainer.appendChild(markerDiv);
                    }
                }
            } catch (e) { console.error("Error in setupClockFace:", e); }
        }

        function setRotation(element, rotationDegrees) {
            if (element) { element.style.transform = `translateX(-50%) rotate(${rotationDegrees}deg)`; }
        }

        function setClock() {
            try {
                const currentDate = new Date();
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                dateDisplay.textContent = currentDate.toLocaleDateString(undefined, options);
                const seconds = currentDate.getSeconds();
                const minutes = currentDate.getMinutes();
                const hours = currentDate.getHours();
                const secondsRatio = seconds / 60;
                const minutesRatio = (secondsRatio + minutes) / 60;
                const hoursRatio = (minutesRatio + hours) / 24;
                const secondsDegrees = secondsRatio * 360;
                const minutesDegrees = minutesRatio * 360;
                const hoursDegrees = hoursRatio * 360;
                setRotation(secondHand, secondsDegrees);
                setRotation(minuteHand, minutesDegrees);
                setRotation(hourHand, hoursDegrees);
            } catch (e) { console.error("Error in setClock:", e); }
        }

        async function fetchPrayerTimes(latitude, longitude, dateString, method = 4) {
            const url = `https://api.aladhan.com/v1/timings/${dateString}?latitude=${latitude}&longitude=${longitude}&method=${method}`;
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`API error: ${response.status} ${response.statusText}`);
                const data = await response.json();
                if (data.code === 200) return data.data.timings;
                else throw new Error(data.status || "Could not fetch prayer times from API data");
            } catch (error) {
                console.error("Error fetching prayer times:", error);
                return null;
            }
        }

        function timeToAngle(timeStr) {
            if (!timeStr) return 0;
            const [hours, minutes] = timeStr.split(':').map(Number);
            if (isNaN(hours) || isNaN(minutes)) return 0;
            const totalMinutesInDay = 24 * 60;
            const prayerTotalMinutes = hours * 60 + minutes;
            const angleRatio = prayerTotalMinutes / totalMinutesInDay;
            return angleRatio * 360;
        }

        function positionPrayerMarker(timeStr, prayerName) {
            if (!timeStr) return;
            try {
                const angleDegrees = timeToAngle(timeStr);
                prayerScheduleForGradient.push({ name: prayerName, time: timeStr, angle: angleDegrees });

                const marker = document.createElement('div');
                marker.classList.add('prayer-marker', prayerName.toLowerCase());
                marker.title = `${prayerName}: ${timeStr}`;

                const radiusPercentForMarkerCenter = 48;
                const xPos = 50 + radiusPercentForMarkerCenter * Math.sin(angleDegrees * Math.PI / 180);
                const yPos = 50 - radiusPercentForMarkerCenter * Math.cos(angleDegrees * Math.PI / 180);

                marker.style.left = `${xPos}%`;
                marker.style.top = `${yPos}%`;
                marker.style.transform = `translate(-50%, -50%)`;

                prayerRing.appendChild(marker);
            } catch (e) { console.error(`Error in positionPrayerMarker for ${prayerName}:`, e); }
        }

        async function reverseGeocode(latitude, longitude) {
            const userAgent = 'PrayerClockApp/1.0 (your-email@example.com)';
            const url = `https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${latitude}&lon=${longitude}&accept-language=en`;
            try {
                const response = await fetch(url, { headers: { 'User-Agent': userAgent } });
                if (!response.ok) {
                    console.warn(`Reverse geocoding API error: ${response.status} ${response.statusText}`);
                    return null;
                }
                const data = await response.json();
                if (data && data.address) {
                    return data.address.city || data.address.town || data.address.village || data.address.county || data.address.state || data.address.country || null;
                }
                console.warn("Reverse geocoding: No address found in response", data);
                return null;
            } catch (error) {
                console.warn("Error during reverse geocoding fetch:", error);
                return null;
            }
        }

        function applyPrayerRingSegmentsSVG() {
            if (prayerScheduleForGradient.length < 5) {
                console.warn("Not enough prayer times (need 5) to generate segments. Found:", prayerScheduleForGradient.length);
                prayerRing.style.backgroundImage = "none";
                return;
            }
            prayerScheduleForGradient.sort((a, b) => a.angle - b.angle);

            const rootStyles = getComputedStyle(document.documentElement);
            const segmentColors = [
                rootStyles.getPropertyValue('--color-segment-1').trim(), // Isha to Fajr
                rootStyles.getPropertyValue('--color-segment-2').trim(), // Fajr to Dhuhr
                rootStyles.getPropertyValue('--color-segment-3').trim(), // Dhuhr to Asr
                rootStyles.getPropertyValue('--color-segment-4').trim(), // Asr to Maghrib
                rootStyles.getPropertyValue('--color-segment-5').trim()  // Maghrib to Isha
            ];

            const prayers = prayerScheduleForGradient;

            const svgSize = 200; // ViewBox size, can be larger for better resolution if needed
            const center = svgSize / 2;
            // Make radius slightly smaller than center to ensure fill, or use stroke-width for a ring
            const radius = svgSize / 2;
            let svgPaths = '';

            function polarToCartesian(centerX, centerY, radius, angleInDegrees) {
                const angleInRadians = (angleInDegrees - 90) * Math.PI / 180.0; // Adjust by -90 so 0 is top
                return {
                    x: centerX + (radius * Math.cos(angleInRadians)),
                    y: centerY + (radius * Math.sin(angleInRadians))
                };
            }

            // Define the segments based on the sorted prayer times
            // prayers[0] = Fajr, prayers[1] = Dhuhr, ..., prayers[4] = Isha
            const segmentsData = [
                { startAngle: prayers[4].angle, endAngle: prayers[0].angle, color: segmentColors[0] }, // Isha to Fajr
                { startAngle: prayers[0].angle, endAngle: prayers[1].angle, color: segmentColors[1] }, // Fajr to Dhuhr
                { startAngle: prayers[1].angle, endAngle: prayers[2].angle, color: segmentColors[2] }, // Dhuhr to Asr
                { startAngle: prayers[2].angle, endAngle: prayers[3].angle, color: segmentColors[3] }, // Asr to Maghrib
                { startAngle: prayers[3].angle, endAngle: prayers[4].angle, color: segmentColors[4] }  // Maghrib to Isha
            ];

            segmentsData.forEach(segment => {
                let startAngle = segment.startAngle;
                let endAngle = segment.endAngle;

                // Handle wrap-around for the Isha to Fajr segment specifically
                if (segment.color === segmentColors[0]) { // Isha to Fajr segment
                    // Arc 1: from Isha's angle to 359.999 degrees
                    let start1 = polarToCartesian(center, center, radius, startAngle);
                    let end1 = polarToCartesian(center, center, radius, 359.999); // Just shy of 360
                    let arcSweep1 = (359.999 - startAngle <= 180) ? "0" : "1";
                    svgPaths += `<path d="M ${center} ${center} L ${start1.x} ${start1.y} A ${radius} ${radius} 0 ${arcSweep1} 1 ${end1.x} ${end1.y} Z" fill="${segment.color}" />`;

                    // Arc 2: from 0 degrees to Fajr's angle
                    let start2 = polarToCartesian(center, center, radius, 0);
                    let end2 = polarToCartesian(center, center, radius, endAngle);
                    let arcSweep2 = (endAngle - 0 <= 180) ? "0" : "1";
                    svgPaths += `<path d="M ${center} ${center} L ${start2.x} ${start2.y} A ${radius} ${radius} 0 ${arcSweep2} 1 ${end2.x} ${end2.y} Z" fill="${segment.color}" />`;
                } else {
                    // Regular segment
                    const start = polarToCartesian(center, center, radius, startAngle);
                    const end = polarToCartesian(center, center, radius, endAngle);
                    // Determine large-arc-flag: 1 if arc > 180 degrees, 0 otherwise
                    const largeArcFlag = ((endAngle - startAngle + 360) % 360) > 180 ? "1" : "0";

                    const pathData = `M ${center} ${center} L ${start.x} ${start.y} A ${radius} ${radius} 0 ${largeArcFlag} 1 ${end.x} ${end.y} Z`;
                    svgPaths += `<path d="${pathData}" fill="${segment.color}" />`;
                }
            });

            const svgString = `<svg viewBox="0 0 ${svgSize} ${svgSize}" xmlns="http://www.w3.org/2000/svg">${svgPaths}</svg>`;
            const dataUrl = `url("data:image/svg+xml,${encodeURIComponent(svgString)}")`;

            prayerRing.style.backgroundImage = dataUrl;
            prayerRing.style.backgroundRepeat = 'no-repeat';
            prayerRing.style.backgroundPosition = 'center';
            prayerRing.style.backgroundSize = 'contain';
        }


        function saveDataToCache(locationName, prayerTimes, dateString) {
            try {
                localStorage.setItem(CACHE_KEY_LOCATION, locationName);
                localStorage.setItem(CACHE_KEY_PRAYER_TIMES, JSON.stringify(prayerTimes));
                localStorage.setItem(CACHE_KEY_TIMESTAMP, JSON.stringify({ timestamp: Date.now(), date: dateString }));
            } catch (e) {
                console.warn("Error saving to localStorage:", e);
            }
        }

        function loadDataFromCache(currentDateString) {
            try {
                const cachedTimestampStr = localStorage.getItem(CACHE_KEY_TIMESTAMP);
                if (!cachedTimestampStr) return null;

                const cachedTimestampData = JSON.parse(cachedTimestampStr);
                const cacheTime = cachedTimestampData.timestamp;
                const cachedDate = cachedTimestampData.date;

                if ((Date.now() - cacheTime > CACHE_DURATION_MS) || (cachedDate !== currentDateString)) {
                    localStorage.removeItem(CACHE_KEY_LOCATION);
                    localStorage.removeItem(CACHE_KEY_PRAYER_TIMES);
                    localStorage.removeItem(CACHE_KEY_TIMESTAMP);
                    return null;
                }

                const locationName = localStorage.getItem(CACHE_KEY_LOCATION);
                const prayerTimesStr = localStorage.getItem(CACHE_KEY_PRAYER_TIMES);

                if (locationName && prayerTimesStr) {
                    return {
                        locationDisplayName: locationName,
                        timings: JSON.parse(prayerTimesStr),
                        dateString: cachedDate
                    };
                }
                return null;
            } catch (e) {
                console.warn("Error loading from localStorage:", e);
                return null;
            }
        }

        async function initPrayerTimes() {
            prayerRing.innerHTML = '';
            prayerScheduleForGradient = [];

            const today = new Date();
            const day = String(today.getDate()).padStart(2, '0');
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const year = today.getFullYear();
            const currentDateString = `${day}-${month}-${year}`;

            let locationDisplayName = "Mecca (Default)";
            let timings = null;
            let usingCache = false;
            let lat = 21.4225, lon = 39.8262;

            const cachedData = loadDataFromCache(currentDateString);

            if (cachedData) {
                locationDisplayName = cachedData.locationDisplayName;
                timings = cachedData.timings;
                usingCache = true;
            } else {
                prayerTimeInfo.textContent = "Attempting to get your location...";

                if (navigator.geolocation) {
                    try {
                        const position = await new Promise((resolve, reject) => {
                            navigator.geolocation.getCurrentPosition(resolve, reject, { timeout: 12000, enableHighAccuracy: false });
                        });
                        lat = position.coords.latitude;
                        lon = position.coords.longitude;

                        prayerTimeInfo.textContent = `Location acquired. Looking up place name...`;
                        const placeName = await reverseGeocode(lat, lon);
                        if (placeName) {
                            locationDisplayName = placeName;
                        } else {
                            locationDisplayName = `Lat: ${lat.toFixed(2)}, Lon: ${lon.toFixed(2)}`;
                        }
                    } catch (geoError) {
                        console.warn("Geolocation error:", geoError.code, geoError.message);
                        let errorMsg = "Geolocation failed";
                        if (geoError.code === 1) errorMsg = "Geolocation permission denied";
                        else if (geoError.code === 2) errorMsg = "Geolocation position unavailable";
                        else if (geoError.code === 3) errorMsg = "Geolocation timed out";
                        prayerTimeInfo.textContent = `${errorMsg}. Using prayer times for ${locationDisplayName}.`;
                    }
                } else {
                    prayerTimeInfo.textContent = `Geolocation not supported. Using prayer times for ${locationDisplayName}.`;
                }

                prayerTimeInfo.innerHTML = `Fetching prayer times for <strong>${locationDisplayName}</strong>...`;
                timings = await fetchPrayerTimes(lat, lon, currentDateString);

                if (timings) {
                    saveDataToCache(locationDisplayName, timings, currentDateString);
                }
            }

            if (timings) {
                let infoText = `Prayer times for <strong>${locationDisplayName}</strong>`;
                if (usingCache) {
                    infoText += " (from cache)";
                }
                infoText += `:<br>F: ${timings.Fajr}, D: ${timings.Dhuhr}, A: ${timings.Asr}, M: ${timings.Maghrib}, I: ${timings.Isha}`;
                prayerTimeInfo.innerHTML = infoText;

                positionPrayerMarker(timings.Fajr, "Fajr");
                positionPrayerMarker(timings.Dhuhr, "Dhuhr");
                positionPrayerMarker(timings.Asr, "Asr");
                positionPrayerMarker(timings.Maghrib, "Maghrib");
                positionPrayerMarker(timings.Isha, "Isha");

                applyPrayerRingSegmentsSVG(); // Changed from applyPrayerRingGradient
            } else {
                prayerRing.style.backgroundImage = "none"; // Clear background if times fail
                if (!prayerTimeInfo.textContent.toLowerCase().includes("error fetching prayer times")) {
                    prayerTimeInfo.innerHTML = `Could not retrieve prayer times for <strong>${locationDisplayName}</strong>.`;
                }
            }
        }

        try {
            setupClockFace();
            setClock();
            initPrayerTimes();
            setInterval(setClock, 1000);
        } catch (e) {
            console.error("Critical error during initial setup:", e);
            document.body.innerHTML = `<p style="color:red; font-size:1.2em; text-align:center; padding:20px;">A critical error occurred: ${e.message}. Please check the console.</p>`;
        }
    </script>

</body>

</html>